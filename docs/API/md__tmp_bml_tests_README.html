<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>bml: ADDING A C TEST</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">bml
   &#160;<span id="projectnumber">1.3.1</span>
   </div>
   <div id="projectbrief">Basic Matrix Library (bml):  A matrix library for linear algebra operations,  supporting several data structures.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md__tmp_bml_tests_README.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">ADDING A C TEST </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>It is essential to add a proper test for each function we create. We would even recommend to add a test before adding the functionality to have a piece of code that could be executed. To do this, we have provided this step-by-step tutorial. Let's consider that we are adding a test which name is "mytest".</p>
<p>We will first modify the three following files accordingly by adding the name of the test in them. Note: Whenever we can we will proceed to add names/files in alphabetical order to keep consistency in the source file.</p>
<p>The three files that need to be modified are:</p>
<ul>
<li>/tests/CMakeLists.txt</li>
<li>/tests/bml_test.c</li>
<li>/tests/bml_test.h</li>
</ul>
<p>In CMakeLists.txt we will add the test name in three places: </p><pre class="fragment">set(SOURCES_TYPED
    test1_typed.c
    ...
    mytest_typed.c
    ...
    testN_typed.c)
</pre><p>; </p><pre class="fragment">add_executable(bml-test
    test1.c
    ...
    mytest.c
    ...
    testN.c)
</pre><p>and </p><pre class="fragment">foreach(N add test1 ... mytest ... testN)
</pre><p>Second, we should modify the bml_test.h to include our "future" header file. We will add the name as follows: </p><pre class="fragment">#include "test1.h"
...
#include "mytest.h"
...
#include "testN.h"
</pre><p>Finally, we will modify the bml_test.c file in four positions. We will first indicate that there is going to be an extra test by increasing the NUM_TEST variable: </p><pre class="fragment">const int NUM_TESTS = &lt;N&gt;;
</pre><p>where N has to be replace by the total number of tests. Next we will add the test name in the test_name array: </p><pre class="fragment">const char *test_name[] =
        { "test1", ... , "mytest", ... , "testN"}
</pre><p>Please ensure that the number of entries in test_name, test_description, and testers matches the value of NUM_TEST. This will be followed by a description of the test: </p><pre class="fragment">const char *test_description[] = {
         "Description of test 1",
          ....
         "Description of mytest",
          ....
         "Description of test N"}
</pre><p>And finally we will add the name of the function that will perform the test: </p><pre class="fragment">const test_function_t testers[] = {
            test_test1,
            ...
           test_mytest,
            ...
           test_testN}
</pre><p>After this is done we will start creating the source code for our test. These files will be created inside /tests/ and will be named as follows:</p>
<ul>
<li>/tests/mytest.c</li>
<li>/tests/mytest.h</li>
<li>/tests/mytest_typed.c</li>
</ul>
<p>This means that for each test we will have a "header file" (mytest.h), a "driver" (mytest.c) and a typed (mytest_typed.c) . In this last file we will add all the fuctionalities for testing (actual test). For these three files we provide templates which names are template.c, template.h and template_typed.c . These files (template-) will have to be renamed to (mytest-). The final step which is left to the developer is to add some lines of code inside mytest_typed.c to make the test work. For example, this can be a difference between two values that has to be less than a tolerance.</p>
<h1><a class="anchor" id="autotoc_md18"></a>
Compiling, running and checking the test</h1>
<p>Once the functionality is added we need to make sure that the test is compiling, running and passing. For this we can do the following:</p>
<p>First we can try to configure the code using the example_build.sh file located inside the main directory. Second, if the configuration proceeds with no error we build the code: </p><pre class="fragment">$ ./example_build
$ cd build; make
</pre><p>If everything is built without problems. We can test the whole code: </p><pre class="fragment">$ make test
</pre><p>or if we want to see details of the test: </p><pre class="fragment">$ make test ARGS="-V"
</pre><p>We can check if the new test we have added appears in the list of tests.</p>
<p>If we want to run just the test we have created we can do: </p><pre class="fragment">$ cd /build/tests
$ ./bml-test -n mytest -t ellpack -p double_complex
</pre><p>The latter means that we will run our test with ellpack matrix type and double_complex precision. Once the test passes for every precision and matrix type we will need to make sure there are no memory leaks in the test or routine. For this we could run valgrind as following: </p><pre class="fragment">$ valgrind ./bml-test -n mytest -t ellpack -p double_complex
</pre><p>You can also trigger tests by running ctest directly.</p>
<p>$ cd build $ ctest -R mytest &ndash;output-on-failure</p>
<p>After all the tests passed, we should indent the new files using the indent.sh Running indent.sh (located in the main folder) will indent all files. </p><pre class="fragment">$ ./indent.sh
</pre><h1><a class="anchor" id="autotoc_md19"></a>
ADDING A FORTRAN TEST</h1>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Wed Sep 9 2020 19:37:59 for bml by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
